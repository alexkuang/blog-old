
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>The Compiler Is Your Friend - alex kuang</title>
  <meta name="author" content="Alex Kuang">

  
  <meta name="description" content="One sentiment I see from people coming from dynamically typed languages (python, ruby) or even Java and C is a general
dismissiveness about static &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://alexkuang.github.io/blog/2016/05/20/the-compiler-is-your-friend">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="alex kuang" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet" type="text/css">
<!--- MathJax Configuration -->
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-44908431-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">alex kuang</a></h1>
  
    <h2>professional yak shaver</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscribe" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewbox="0 0 100 100"><path class="social" d="M 13.310204,73.332654 C 5.967347,73.332654 0,79.322448 0,86.621428 c 0,7.338776 5.967347,13.262246 13.310204,13.262246 7.370408,0 13.328572,-5.92245 13.328572,-13.262246 0,-7.29898 -5.958164,-13.288774 -13.328572,-13.288774 z M 0.01530612,33.978572 V 53.143878 C 12.493878,53.143878 24.229592,58.02347 33.068368,66.865306 41.894898,75.685714 46.767346,87.47449 46.767346,100 h 19.25 C 66.017346,63.592858 36.4,33.979592 0.01530612,33.978572 l 0,0 z M 0.03877552,0 V 19.17449 C 44.54796,19.17551 80.77551,55.437756 80.77551,100 H 100 C 100,44.87653 55.15102,0 0.03877552,0 z"></path></svg></a></li>
  
</ul>
  
  
  
  
  
  
  
    
      <form action="https://www.google.com/search" method="get">
        <fieldset role="search">
          <input type="hidden" name="sitesearch" value="alexkuang.github.io" />
    
          <input class="search" type="text" name="q" results="0" placeholder="Search"/>
        </fieldset>
      </form>
  
<ul class="main-navigation">
  <li><a href="/about">about</a></li>
  <li><a href="/">blog</a></li>
  <li><a href="/blog/archives">archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      
        <h1 class="entry-title">The Compiler Is Your Friend</h1>
      
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-05-20T07:06:20-04:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>7:06 am</span></time>
        
        
      </p>
    
  </header>


<div class="entry-content"><p>One sentiment I see from people coming from dynamically typed languages (python, ruby) or even Java and C is a general
dismissiveness about static typing and compilers.  At best, the sentiment is &ldquo;Oh, well it makes sure my input is an Int,
or a Float, or a Bool&hellip;  That&rsquo;s cool I guess, but I can do that with TDD&rdquo;.  At worst, static typing is seen as
something to fight against &ndash; shackles that limit our creativity and bar us from what we <em>really</em> want to do and the
beautiful programs that we could write if only the type-checker got out of our way.</p>

<p>Personally, I think of the type-checker (and by extension the compiler, really) not only as a free suite of rigorous
tests built from first principles, but as a friend that is nice enough to correct me, the silly human, when I think I&rsquo;m
making sense but I&rsquo;m really not.  Sure, sometimes that friend is a bit dense (<em>ahem</em> Java, <em>ahem</em>) and can&rsquo;t quite
understand what I&rsquo;m trying to say, but in the case of a language like Scala I find that the compiler is right more often
than not.  In fact, I had a whole giant wall of text geared up to talk about the value in using <code>Option</code> over <code>null</code>, in
using <code>Either</code> instead of exceptions, in capturing values without using Stringly-Typed data&hellip;  But then Li Haoyi beat
me to it with another addition to his wonderful Strategic Scala Style series: <a href="http://www.lihaoyi.com/post/StrategicScalaStylePracticalTypeSafety.html">Practical Type Safety</a>.
I highly recommend reading it (and the rest of the Strategic Scala Style series) before coming back.</p>

<p>Still here?  That post covers a lot of what I wanted to say, but I wanted to put some extra emphasis on one particular
topic:</p>

<p><img class="center" src="/images/adts.jpg"></p>

<!-- more -->


<h3>ADTs (!!!)</h3>

<p>ADTs (Algebraic Data Types) are so, so good.  You can take a lot of features away in Scala and I could probably get by,
but ADTs &ndash; Or at least, the closest Scala approximation &ndash; are on the short list that you&rsquo;d have to pry out of my cold
dead hands&hellip; Along with higher order functions and pattern matching, probably.</p>

<p>So, a quick review&hellip;  What are Algebraic Data Types?  ADTs are so named because their structure can be described in two
operations: Product, and Sum.</p>

<h4>Product Types</h4>

<p>Product types are present in one form or another in the vast majority of mainstream programming languages.  People may
know it as a struct in C, or a record, or a tuple, or a <code>case class</code> in Scala.  It&rsquo;s essentially a way of mashing
multiple types together into one type.  The reason it is called a product type is because the cardinality of the type
(i.e., the set of all possible values for it), is the product of the cardinality of the type&rsquo;s constituents.  Some quick
examples:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="c1">// Has 2 possible values: A(true), A(false)</span>
</span><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">A</span><span class="o">(</span><span class="n">b</span><span class="k">:</span> <span class="kt">Boolean</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// has (2 * 2 = 4) possible values: AA(true, true), AA(true, false), AA(false, true), AA(false, false)</span>
</span><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">AA</span><span class="o">(</span><span class="n">b1</span><span class="k">:</span> <span class="kt">Boolean</span><span class="o">,</span> <span class="n">b2</span><span class="k">:</span> <span class="kt">Boolean</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Sum Types</h4>

<p>Where product types express &ldquo;this <em>and</em> that <em>and</em> the other thing&rdquo;, sum types (also commonly known as union types)
express &ldquo;this <em>or</em> that <em>or</em> the other thing&rdquo;.  Sum types are so named because the cardinality of a sum type is the
sum of the cardinality of the type&rsquo;s consituents.  Unfortunately in Scala 2.x, there isn&rsquo;t direct support for sum types,
but they can be roughly approximated with <code>sealed trait</code>.  Some examples:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="c1">// Probably not how any of this is implemented in the actual standard lib but you get the idea  :)</span>
</span><span class='line'><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Boolean</span>
</span><span class='line'><span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">True</span> <span class="k">extends</span> <span class="nc">Boolean</span>
</span><span class='line'><span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">False</span> <span class="k">extends</span> <span class="nc">Boolean</span>
</span><span class='line'>
</span><span class='line'><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Option</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span>
</span><span class='line'><span class="nc">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Some</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Option</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span>
</span><span class='line'><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">None</span> <span class="k">extends</span> <span class="nc">Option</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Either</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">]</span>
</span><span class='line'><span class="nc">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Left</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Either</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">]</span>
</span><span class='line'><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Right</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">b</span><span class="k">:</span> <span class="kt">B</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Either</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>One cheerful note is that proper union type support was announced for Dotty at ScalaDays 2016, so hurrah!  *confetti*</p>

<h3>So What?</h3>

<p>At first glance, ADTs might seem simplistic &ndash; kinda like fancied up named tuples.  But they are deceptively powerful,
because combining them effectively allows you to encode invariants about your program&rsquo;s logic and state in the
type system, and therefore leverage the compiler to keep you from violating those invariants and writing buggy software.</p>

<p>Which sounds like a bunch of abstract nonsense, so it&rsquo;s time for a concrete example!</p>

<h3>Modeling Real Life: Wrangling User Lists</h3>

<p>Working in the marketing space, it is very common to deal with lists of users.  It can be a list of users from a mailing list, a list
of website visitors, or a list of people who have downloaded your white paper.  In any case, it is a list of users that you
have in your possession, and you want to follow them around the internet and serve them ads.  Such a list of users might
have attributes like an id and a human-readable name.  Since most folks aren&rsquo;t in the business of building exchanges,
it might also have a downstream platform to target (e.g., AdWords, or Facebook).  It might also have some different
states that keep track of whether the list&rsquo;s meta-data has been sent to the downstream platform, or whether it&rsquo;s been
archived or soft-deleted and when that state transition happened.</p>

<p>So one reasonable implementation at a data structure for such a user list might look something like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">ListStatus</span>
</span><span class='line'><span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">Pending</span> <span class="k">extends</span> <span class="nc">ListStatus</span>
</span><span class='line'><span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">Active</span> <span class="k">extends</span> <span class="nc">ListStatus</span>
</span><span class='line'><span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">Archived</span> <span class="k">extends</span> <span class="nc">ListStatus</span>
</span><span class='line'>
</span><span class='line'><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Platform</span>
</span><span class='line'><span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">Facebook</span> <span class="k">extends</span> <span class="nc">Platform</span> <span class="c1">// And so on and so forth</span>
</span><span class='line'>
</span><span class='line'><span class="k">case</span> <span class="k">class</span> <span class="nc">UserList</span><span class="o">(</span>
</span><span class='line'>  <span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span>
</span><span class='line'>  <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
</span><span class='line'>  <span class="n">platform</span><span class="k">:</span> <span class="kt">Platform</span><span class="o">,</span>
</span><span class='line'>  <span class="n">status</span><span class="k">:</span> <span class="kt">ListStatus</span><span class="o">,</span>
</span><span class='line'>  <span class="n">createdTime</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span>
</span><span class='line'>  <span class="n">archivedTime</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Long</span><span class="o">],</span>
</span><span class='line'>  <span class="n">downstreamId</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="c1">// i.e., a &quot;foreign key&quot; to the list on the downstream platform</span>
</span><span class='line'><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>At first glance, this seems like pretty reasonable code.  The various states and platforms are enumerated, and it seems
to carry all the information we want with decent naming and so on.  At the very least it&rsquo;s better than carting around a
tab-separated string, or something like <code>val list: (Long, String, ListStatus, Long, Option[Long], Option[String])</code>.</p>

<p>But there&rsquo;s still something a bit off here.  In particular, look around the optional fields.  With this current model,
it is possible to construct an internally inconsistent list:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">val</span> <span class="n">list</span> <span class="k">=</span> <span class="nc">UserList</span><span class="o">(</span>
</span><span class='line'>  <span class="n">id</span> <span class="k">=</span> <span class="mi">1</span><span class="o">,</span>
</span><span class='line'>  <span class="n">name</span> <span class="k">=</span> <span class="s">&quot;website visitors&quot;</span><span class="o">,</span>
</span><span class='line'>  <span class="n">platform</span> <span class="k">=</span> <span class="nc">Facebook</span><span class="o">,</span>
</span><span class='line'>  <span class="n">status</span> <span class="k">=</span> <span class="nc">Active</span><span class="o">,</span>
</span><span class='line'>  <span class="n">createdTime</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">,</span>
</span><span class='line'>  <span class="n">archivedTime</span> <span class="k">=</span> <span class="nc">None</span><span class="o">,</span>
</span><span class='line'>  <span class="n">downstreamId</span> <span class="k">=</span> <span class="nc">None</span> <span class="c1">// Wait, what?</span>
</span><span class='line'><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The example above is internally inconsistent because the list&rsquo;s active status indicates that it should be onboarded to
the downstream platform, but for some reason we do not have a downstream id.  There are other &ldquo;weird&rdquo; cases like this
that are possible but do not make sense semantically &ndash; for example, <code>archivedTime = Some(1)</code> with <code>status = Pending</code>.</p>

<p>This data structure is almost trivially simple, but there area already a good number of things that can go wrong,
especially once we take outside input and possibly complex business logic into account.  And here there&rsquo;s nothing
stopping us from constructing these degenerate cases other than our ability to keep everything in our heads (spotty even
at the best of times) and read the code <em>really really</em> carefully every time we work with this particular data structure
(good luck).</p>

<p>Another point to consider is what this does to the code that works with the data:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="c1">// Send users from our list to downstream platform so we can serve them ads</span>
</span><span class='line'><span class="k">def</span> <span class="n">onboardUsersToList</span><span class="o">(</span><span class="n">list</span><span class="k">:</span> <span class="kt">UserList</span><span class="o">,</span> <span class="n">users</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">User</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">list</span><span class="o">.</span><span class="n">status</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="nc">Active</span> <span class="k">=&gt;</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">platformId</span> <span class="k">=</span> <span class="n">list</span><span class="o">.</span><span class="n">downstreamId</span><span class="o">.</span><span class="n">getOrElse</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// this should never happen</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nc">IllegalStateException</span><span class="o">(</span><span class="s">&quot;Downstream id not found for active list&quot;</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">platformClient</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="n">platform</span><span class="o">).</span><span class="n">sendUsers</span><span class="o">(</span><span class="n">platformId</span><span class="o">,</span> <span class="n">users</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">IllegalArgumentException</span><span class="o">(</span><span class="s">&quot;Cannot onboard users for non-active list&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above code is a conceptually simple method that takes users from our list and sends them to a downstream platform,
e.g.  Facebook.  It technically does what we want, but there is a lot of clutter introduced by the management of the
status.  The block under <code>list.downstreamId.getOrElse</code> is particularly bad, since it basically amounts to saying &ldquo;well
we don&rsquo;t think we&rsquo;re wrong, but we technically could be wrong, so we have to sprinkle this boilerplate-ish error
handling into our business logic&rdquo;.  Apparently, this sort of thing is
<a href="https://github.com/anthavio/anthavio-commons/blob/e1982362cb3671c85b79923b1b3199f6eee8d60f/src/main/java/net/anthavio/NeverHappenException.java">not</a>
<a href="https://github.com/adi-bolb/pair-programming-match-making/blob/51496f4b854c56974324d3f97ac19b7e76ac9a54/src/main/java/org/findapair/ThisShouldNeverHappenException.java">that</a>
<a href="https://github.com/akestner/DockerPlugin/blob/42abd2aaf6c649827d4101250bee761d0f65d160/src/com/akestner/plugins/docker/exception/ShouldNotHappenException.java">uncommon</a>.</p>

<p>One possible remedy is to refactor <code>UserList</code> to encode some of the constraints into the type:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">UserListMetadata</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">platform</span><span class="k">:</span> <span class="kt">Platform</span><span class="o">,</span> <span class="n">createdTime</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">UserList</span> <span class="o">{</span> <span class="n">metadata</span><span class="k">:</span> <span class="kt">UserListMetadata</span> <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">PendingList</span><span class="o">(</span><span class="n">metadata</span><span class="k">:</span> <span class="kt">UserListMetadata</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">UserList</span>
</span><span class='line'><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">ActiveList</span><span class="o">(</span><span class="n">metadata</span><span class="k">:</span> <span class="kt">UserListMetadata</span><span class="o">,</span> <span class="n">downstreamId</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">UserList</span>
</span><span class='line'><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">ArchivedList</span><span class="o">(</span><span class="n">metadata</span><span class="k">:</span> <span class="kt">UserListMetadata</span><span class="o">,</span> <span class="n">archivedTime</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">UserList</span>
</span></code></pre></td></tr></table></div></figure>


<p>This lets us rewrite the above method as:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">def</span> <span class="n">onboardUsersToList</span><span class="o">(</span><span class="n">list</span><span class="k">:</span> <span class="kt">ActiveList</span><span class="o">,</span> <span class="n">users</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">User</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">platformClient</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">platform</span><span class="o">).</span><span class="n">sendUsers</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="n">downstreamId</span><span class="o">,</span> <span class="n">users</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>At this point, one might protest, &ldquo;That just makes you push the status validation somewhere else!  The first
implementation was just bad practice, you could easily have written this simple version with the old type by refactoring
to <code>def onboardUsersToList(downstreamId: String, users: Seq[User])</code>.&rdquo;  Yes, this is perfectly true.  The validation
still has to take place <em>somewhere</em> since the code will presumably be interacting with the outside world.  The
difference here is that the former implementation can only enforce cleanliness and correctness with malleable things
like documentation and best practice guidelines, whereas the latter implementation enforces it by simply <em>refusing to
compile until you fix it</em>.  The latter implementation also reduces the amount of &ldquo;unforced&rdquo; errors since it is
impossible to construct an <code>ActiveList</code> object without a <code>downstreamId</code>, whereas it was possible to accidentally create
a <code>UserList(status = Active, downstreamId = None)</code> previously.</p>

<h3>Stepping back</h3>

<p>Hopefully the above example demonstrated a reasonable real-world case where ADTs can be really useful.  ADTs seem really
basic &ndash; and in the vast world of type hackery they are only a starting point &ndash; but you can do some surprisingly
powerful things with these fundamental building blocks.</p>

<p>There is one last point I want to make.  As a professional programmer (i.e., employed by a business to write code that
ostensibly generates some amount of profit), the goal of all this is not to encode the world at the type level.  The
goal is to reduce complexity and mental overhead.  There are some insane things possible once you go down the rabbit
hole of type hackery &ndash; for example, <a href="http://jto.github.io/articles/typelevel_quicksort/">type-level quicksort</a>.  This
is all great fun and by no means a bad thing, but at some point it&rsquo;s important to step back and think, &ldquo;Right, somebody
else actually has to read, maintain, and modify this code at some point.  <em>Maybe</em> this should not go into production.&rdquo;</p>

<p>This is especially important to keep in mind in a language like Scala, which provides us with plentiful amounts of
power to complicate things and shoot ourselves in the foot if we&rsquo;re not careful.  Or, in other words:</p>

<p><img class="center" src="/images/can_should.jpg">
(Source: <a href="https://twitter.com/ThePracticalDev/status/730177044030566400">https://twitter.com/ThePracticalDev/status/730177044030566400</a>)</p>
</div>


  <footer>
    <p class="meta">
      
  



  <span class="byline author vcard">Authored by <span class="fn">
  
    Alex Kuang
  
  </span></span>


      




<time class='entry-date' datetime='2016-05-20T07:06:20-04:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>7:06 am</span></time>
      
      

<span class="categories">
  
    <a class='category' href='/blog/categories/scala/'>scala</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://alexkuang.github.io/blog/2016/05/20/the-compiler-is-your-friend/" data-via="" data-counturl="http://alexkuang.github.io/blog/2016/05/20/the-compiler-is-your-friend/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/04/26/writing-an-api-client-with-akka-http/" title="Previous Post: Writing an API Client with akka-http">&laquo; Writing an API Client with akka-http</a>
      
      
    </p>
  </footer>
</article>


</div>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Alex Kuang -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  










  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
